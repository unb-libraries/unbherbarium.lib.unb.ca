language: php

services:
  - docker

php:
  - '7.1'

cache:
  directories:
    - $HOME/.composer/cache

git:
  depth: 1

env:
  global:
    - SERVICE_NAME=unbherbarium.lib.unb.ca
    - AMAZON_ECR_REGION=us-east-1
    - DEPLOY_BRANCHES=dev,prod
    - DEPLOYMENT_FINISHED_MARKER=99_report_as_complete
    - DOCKER_UPSTREAM_IMAGE=unblibraries/drupal:8.x-1.x
    - OLD_IMAGES_TO_KEEP=2
    - SERVICE_DEPLOY_PORT=80
    - SERVICE_TEST_UP_PATH=/user

before_install:
  - curl -sSL https://raw.githubusercontent.com/unb-libraries/CargoDock/drupal-8.x-1.x/travis/deploy.sh | sh
  - CargoDock/travis/beforeInstall.sh

before_script:
  - CargoDock/travis/beforeScript.sh

script:
  - CargoDock/travis/testInstance.sh

after_success:
  - CargoDock/travis/afterSuccess.sh

notifications:
  slack:
    rooms:
      secure: po7aCnHKpTzDgqhkRFzF4zfZvQBSt8aIsEqDozuX8BqF9BxGD/VEgOUoXhp4bH/ulqLFeNnnEt2nNhG5oKumRotrrCpRLgP69m5gwIKstZaqd7yZGa9388LD2e41hQJS6OBfPjb2Wa+WSqSB5RSJFi40u9dfxtCFTCtOdSotCzVa0rGHnHUuJUkX2OiMOA053fO3/9sV4H/Z1zeYcfCmP4gxFIfvFnuiR4etMnmDz63pzXKnlAWM3sx6Bd1qTa3xSAcCustNm0kMAV6p+oPJ3fv0Sbo113/bL7PQSMfTOGdaPINxTECx7NnhEOn1HD/LtlDEY7zft8HQysIYq6tjOQxzBN14UOvQF1D0o+DJr6yQ6WfWJ1UVUw02YI92V5zIxwrMewXxLZ/u6NT9rjGZ3a66NR7LGfOHYU4JYbJpZI5lDFv3lAXwElTUZBrjb/luXjTmfbbZeenMTpEcs7v7rlGAPufQFQWarevm9i5mDw39BcvNsFBo8a/rfWt12+ScCJTNxTp1r4JmKTKOLf6c+LY5lyWEFXFuk9l8Mo5UFvF4aYyAKeFqeHbCJGQQ356gYwLEVduJh4L3CyIlABPr+nEiKhLaOwNi+cZcW3q2hW56F6/dOMqwZBZ9Aur93urwnhgCsUh2tFQlLJBRczsIT2AYm4FGdSgKeDPVPlZFWQI=
    on_start: always
    on_success: always
