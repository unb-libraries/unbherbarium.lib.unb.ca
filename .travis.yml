language: php

services:
  - docker

php:
  - '7.2'

git:
  depth: 1

before_install:
  - curl -Ls https://raw.githubusercontent.com/unb-libraries/dockworker/3.x/scripts/travis/init.sh | bash
  - composer install

script:
  - set -e
  - vendor/bin/dockworker local:build-test
  - vendor/unb-libraries/dockworker/scripts/kubectl/init.sh
  - vendor/bin/dockworker image:deploy $TRAVIS_BRANCH
  - vendor/bin/dockworker deployment:logs:check $TRAVIS_BRANCH
  - vendor/unb-libraries/dockworker/scripts/travis/notifyNewRelicDeployment.sh

notifications:
  slack:
    rooms:
      secure: U+PscAnZTScvQ04xvUN1xqVXcK2nqgRtQpJtOgIdiOFjh6MEt5WZowscCEfCEvSXYfU03WgABx5m4JCggoHSDaf9CTtIdN9T9iIWwYJxmz70U6T6/QJOciOaXNB+T91Wuiyf83K//mCksWIJrLOBak2d+KA3EaJEv08XHxO8wLUFadmw+J3W2BngK+ygBeX2Nk6j3hucBYf8Y72B2wOqV1KIbZ/XpH0R0qBgFoEqypSp1qxSsqdgdEfeEJ3qC5qw8p8DgKbiL9yynLp9jGxdfYdN1di8p39Sy9y5GBmR/cjhIcxvyRrjAae8/TR1t61GbFcLL2l9IV5ddvcNdfLxvbW8KIALbKCxxYY1NfpBxBB2uOT42WX3h/wzaLq9ssixoWBFsQo15NdzLJ09ZUhOFvlVwqGJ1bA7AkfNYQQGAca+Caeo8fZbSEhB5l+xmTDZwS0aJnM06IRhMabv4wMengJprzF09UVXPhSfqeiMehzQPZ4QZQ/ORippBocpQdBOC2FdppYLVaExg0VW7hOvlLhEUsZ3PqGVaBRmzbazslWF34/RRNDZLP4dRNPAd58W9yVK6MCHOFQ3IompidjgV/HwguyONtEzcLo04AMDgZxo/Ly9U+88Ye+qeaUdhz6/kQHSC2kW1cI8WF8k49zYm8ChTklQWgxX9cI+P5C9I78=
    on_start: always
    on_success: always
